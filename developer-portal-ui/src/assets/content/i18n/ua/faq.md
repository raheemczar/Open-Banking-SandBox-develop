<div class="centeredText">

# Часті питання (FAQ)

</div>

<div class="divider">
</div>

# Згода на використання даних облікового запису

## Чому я не можу створити згоду?

Роль у сертифікаті QWAC не містить роль AIS. У цьому випадку ви повинні отримати подібну помилку:

```json
{
  "timestamp": 1549441548991,
  "status": 403,
  "error": "Forbidden",
  "message": "You don\"t have access to this resource",
  "path": "/v1/consents"
}
```

Рішення: або створіть новий сертифікат, що містить AIS ролі, і вставте цей сертифікат у ваш запит, або декодуйте ваш сертифікат і перевірте qcStatement, який повинен містити "PSP_AI".

Інша можливість полягає в тому, що атрибут "recurringIndicator" в межах вашого запиту встановлюється в "false", в той час як атрибут "frequencyPerDay" не дорівнює "1". За замовчуванням "recurringIndicator" має бути "true", оскільки TPP хоче отримати доступ до даних облікового запису у вказаний проміжок часу. Однак, коли TPP хоче просто відобразити список можливих облікових записів, достатньо одноразового доступу. У цьому випадку ви повинні отримати таку помилку:

```json
{
  "tppMessages": [
    {
      "category": "ERROR",
      "code": "FORMAT_ERROR",
      "path": null,
      "text": "Format of certain request fields are not matching the XS2A requirements."
    }
  ],
  "_links": null
}
```

Рішення: Якщо ви хочете отримати доступ до даних облікового запису, використовуючи цю згоду лише один раз, змініть значення "frequencyPerDay" на "1". В іншому випадку призначте "true" для "recurringIndicator".

## Чому я не можу отримати доступ до даних свого облікового запису?

Можливо, що видана згода не дозволяє цю операцію. Погодження AIS визначає три рівні доступу. Перший рівень дозволяє отримати доступ до "рахунків", другий - до "балансів", а третій - до "транзакцій". Можливі комбінації, а вибір "балансів" або "транзакцій" також надає доступ до "рахунків". Згода, що надає доступ до, наприклад, рахунків і транзакцій, не дозволяє відображати баланси.

Іншою причиною може бути те, що згода є недійсною. Термін дії згоди, наприклад, автоматично закінчується, коли перевищується "термін дії", визначений у згоді. Можливо, виникла помилка під час виконання автентифікація.

<div class="divider">
</div>

# Сильна автентифікація клієнтів

## Як я можу змінити статус транзакції / консента?

За замовчуванням нова створена транзакція / консент має статус "received" . Для того, щоб виконати SCA за допомогою підходу REDIRECT, ModelBank надає сервер перенаправлення, де стан оновлюється залежно від PSU. Оскільки SCA для REDIRECT спрощений для цього ModelBank, для передачі цілого SCA достатньо пройти PSU-ідентифікатор через Query-Parameter.

Параметр запиту psu-id є обов’язковим. Якщо це не передбачено, сервер перенаправлення відображатиме повідомлення про помилку за замовчуванням.

## Чому я не можу змінити статус транзакції / консенту за допомогою певного PSU?

Якщо статус транзакції / консенту "received", можливо, PSU-ідентифікатор не відповідає IBAN у запиті про ініціювання платежу або створення консенту. Вiдповiднiсть між PSU-ID та IBAN (ими) задокументовано на порталі розробників. Якщо стан не змінюється, навіть якщо SCA було виконано, а IBAN відповідає PSU-ID, перевірте PSU-ID на помилки друку та регістру.

<div class="divider">
</div>

# Сертифікати

## Як створити дійсний сертифікат?

Щоб отримати доступ до API XS2A, TPP має мати дійсний сертифікат автентифікації веб-сайту (QWAC), який зазвичай отримує зареєстрований постачальник довірчих послуг. Для використання ModelBank можна видати тестові сертифікати тут: . Ви отримуєте сертифікат, що підписується самостійно (.pem) і відповідний закритий ключ (.key) вбудований у .zip файл.

## Як вбудувати сертифікат у запит?

Після отримання QWAC потрібно вставити його у свій запит. Існує багато інструментів для виконання викликів REST. Ми пояснюємо конфігурацію з двома найпоширенішими - cURL і Postman. cURL: додайте файл .pem використовуючи --cert ./certificate.p і закритий ключ за допомогою --key ./private.key. Зауважте, що вам може знадобитися адаптувати відносний шлях до файлів. Postman: Перейдіть до пункту "Preferences > Certificates > Add Certificate" і встановіть URL-адресу хосту (у нашому прикладі це буде ). Зверніть увагу, що "https://" а також порт 443 вже встановлені. Потім додайте файл .pem та файл .key Пароль повинен залишатися порожнім.

## Чому сертифікат QWAC не працює?

Запити можуть не працювати, навіть якщо додано сертифікат. Це відбувається, коли термін дії сертифікатів закінчується. Кожен сертифікат має атрибут "validUntil" з терміном дії. У цьому випадку ви повинні отримати таку помилку:

```json
{
  "tppMessages": [
    {
      "category": "ERROR",
      "code": "CONSENT_EXPIRED",
      "path": null,
      "text": "The consent was created by this TPP but has expired and needs to be renewed"
    }
  ],
  "_links": null
}
```

Потрібний PSU для створення нової згоди і використання нової згоди. Інша можливість полягає в тому, що сертифікат не містить потрібну вам роль для вашого запиту. Наприклад, роль "PIS" не дозволяє створювати згоди. У такому випадку ви повинні отримати таку помилку:

```json
{
  "tppMessages": [
    {
      "category": "ERROR",
      "code": "CONSENT_INVALID",
      "path": null,
      "text": "The consent was created by this TPP but is not valid for the addressed service/resource"
    }
  ],
  "_links": null
}
```
